<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>TaÃ¯Kan â€” DextÃ©ritÃ©</title>
<link rel="stylesheet" href="../style.css">
<meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body class="page-flex">

<h1>DextÃ©ritÃ©</h1>

<a href="../index.html">
  <img src="../images/logo.png" class="logo-pwa">
</a>

<p class="subtitle">
exercices de travail de la mobilitÃ© articulaire :
rapiditÃ©, fluiditÃ©, prÃ©cision du geste
</p>

<div class="controls">
  <select id="niveau"></select>
  <select id="materiel"></select>
  <select id="modalite"></select>
<button class="kawaii-btn" onclick="techniqueRandom()">ğŸ² Surprise</button>

</div>

<div id="card" class="tech-card"></div>
<div class="training-bar">
  <button class="kawaii-btn" onclick="toggleVoice()">ğŸ”Š Lecture / Pause</button>
  <button class="kawaii-btn" onclick="startTimer()">â±ï¸ DÃ©marrer</button>
  <span id="timer">00:00</span>
</div>


<script>
let data = [];
let current = null;
let synth = speechSynthesis;
let utterance = null;
let timerInterval = null;
let seconds = 0;

fetch("../data/dext.json")
.then(r=>r.json())
.then(d=>{
 data = d;
 initFilters();
 afficher(d[0]);
});

function initFilters(){
 const niveaux=[...new Set(data.map(x=>x.niveau))];
 const materiels=[...new Set(data.flatMap(x=>x.materiel))];
 const modalites=[...new Set(data.flatMap(x=>x.modalite))];

 fillSelect("niveau",niveaux);
 fillSelect("materiel",materiels);
 fillSelect("modalite",modalites);

 document.querySelectorAll("select").forEach(s=>s.onchange=applyFilters);
}

function fillSelect(id,values){
 const s=document.getElementById(id);
 s.innerHTML="<option value=''>Tous</option>";
 values.forEach(v=>s.innerHTML+=`<option>${v}</option>`);
}

function applyFilters(){
 const n=niveau.value;
 const m=materiel.value;
 const mo=modalite.value;

 const filtered=data.filter(t=>
  (!n||t.niveau===n) &&
  (!m||t.materiel.includes(m)) &&
  (!mo||t.modalite.includes(mo))
 );

 if(filtered.length) afficher(filtered[0]);
}

function afficher(t){
 current=t;

 const badgesMateriel = t.materiel.map(x=>`<span class="badge">${x==="canne"?"ğŸ¦¯":"æ£’"}</span>`).join("");
 const badgesPosture = t.modalite.map(x=>`<span class="badge">${x==="debout"?"ğŸ§":"ğŸª‘"}</span>`).join("");

 document.getElementById("card").innerHTML=`
   <div class="title-row">
     <h2>${t.nom}</h2>
     <button class="info-btn" onclick="showInfo()">â„¹ï¸</button>
   </div>

   <div class="badges">${badgesMateriel} ${badgesPosture}</div>
   <p>${t.description}</p>

   <iframe src="${t.video}" allowfullscreen></iframe>
 `;
}

function techniqueRandom(){
 afficher(data[Math.floor(Math.random()*data.length)]);
}

function toggleVoice(){
 if(!current) return;

 if(synth.speaking){
   synth.cancel();
   return;
 }

 utterance=new SpeechSynthesisUtterance(current.description);
 utterance.rate=0.7;
 synth.speak(utterance);
}

function startTimer(){
 clearInterval(timerInterval);
 seconds=0;
 timerInterval=setInterval(()=>{
  seconds++;
  const m=Math.floor(seconds/60).toString().padStart(2,"0");
  const s=(seconds%60).toString().padStart(2,"0");
  timer.textContent=`${m}:${s}`;
 },1000);

 saveProgress();
}

function saveProgress(){
 localStorage.setItem("taikan_last",current.nom);
}
  function showInfo(){
 if(!current.explication) return;
 alert(current.explication);
}
</script>

</body>
</html>
